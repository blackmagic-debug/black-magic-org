<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="../_static/favicon/icon.svg">
    <link rel="icon" sizes="16x16" type="image/png" href="../_static/favicon/favicon-16x16.png">
    <link rel="icon" sizes="32x32" type="image/png" href="../_static/favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="57x57" type="image/png" href="../_static/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" type="image/png" href="../_static/favicon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" type="image/png" href="../_static/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" type="image/png" href="../_static/favicon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="96x96" type="image/png" href="../_static/favicon/apple-touch-icon-96x96.png">
    <link rel="apple-touch-icon" sizes="114x114" type="image/png" href="../_static/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" type="image/png" href="../_static/favicon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" type="image/png" href="../_static/favicon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" type="image/png" href="../_static/favicon/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="../_static/favicon/apple-touch-icon-180x180.png">
    <link rel="android-icon" sizes="192x192" type="image/png" href="../_static/favicon/android-icon-192x192.png"><meta property="og:title" content="GDB Flash Automation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://black-magic.org/usage/gdb-automation.html" />
<meta property="og:site_name" content="Black Magic Debug" />
<meta property="og:description" content="In many cases it is useful to automatically flash and test the uploaded firmware. GDB has a built in scripting language as well as python bindings. Here is a collection of a few ways to automate th..." />
<meta property="og:image" content="https://black-magic.org/_static/blackmagic-logo.png" />
<meta property="og:image:alt" content="Black Magic Debug" />
<meta name="description" content="In many cases it is useful to automatically flash and test the uploaded firmware. GDB has a built in scripting language as well as python bindings. Here is a collection of a few ways to automate th..." />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Semihosting" href="semihosting.html"><link rel="prev" title="GDB Commands" href="gdb-commands.html">
        <link rel="canonical" href="https://black-magic.org/usage/gdb-automation.html">
        <link rel="prefetch" href="../_static/blackmagic-logo.svg" as="image"> 

<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Blog"
/>



    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>GDB Flash Automation - Black Magic Debug</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/asciinema-player_3.12.1.css" />
    <link rel="stylesheet" type="text/css" href="../_static/ablog/tagcloud.css?v=4271035a" />
    <link rel="stylesheet" type="text/css" href="../_static/ablog/styles_for_furo.css?v=e882fc94" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Black Magic Debug</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/blackmagic-logo.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Black Magic Debug</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported-targets.html">Supported Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledgebase</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/pinouts.html">Pinout Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/compiling-windows.html">Compiling on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/bmputil-on-windows.html">Building <code class="docutils literal notranslate"><span class="pre">bmputil</span></code> on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gdb-commands.html">GDB Commands</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">GDB Flash Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="semihosting.html">Semihosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="swo.html">Serial Wire Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="rtt.html">Using RTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="platformio.html">PlatformIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Target Specific Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/stm32.html">STM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/sam3x-4x-x7x.html">SAM3x-4x-x7x</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hacking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hacking/contrib.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/hacking.html">Firmware Hacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-drivers.html">Adding Target Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-cortex-m.html">Cortex-M Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-cortex-a.html">Cortex A Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-mm32.html">MindMotion MM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-clock-generation.html">Target Clock Generation</a></li>
</ul>

</div><h3>Versions</h3>
<ul>
	<li><a href="/">BMD 2.0 (in development)</a></li>
	<li><a href="/v1.x">BMD 1.10.2 (stable)</a></li>
</ul>
<div class="ablog-sidebar-item ablog__recentposts">
<h3>
  <a href="../blog.html">Recent Posts</a>
</h3>
<ul>
  
  
  <li>
    <a href="../blog/2025-07-19-bmd-release-v2_0_0.html">
      19 July - Black Magic Debug V2.0.0 Stable Release
    </a>
  </li>
  
  <li>
    <a href="../blog/2025-07-12-bmputil-release-v1_0_0.html">
      12 July - bmputil V1.0.0 Stable Release
    </a>
  </li>
  
  <li>
    <a href="../blog/2025-03-03-release-candidate-v2_0_0-rc2.html">
      03 March - Black Magic Debug V2.0.0-rc2 Release Candidate
    </a>
  </li>
  
  <li>
    <a href="../blog/2025-01-07-release-candidate-v2_0_0-rc1.html">
      07 January - Black Magic Debug V2.0.0-rc1 Release Candidate
    </a>
  </li>
  
  <li>
    <a href="../blog/2024-01-11-release-v1_9_3.html">
      11 January - Black Magic Debug V1.9.3 Stable Release
    </a>
  </li>
  
</ul>
</div>

<div class="ablog-sidebar-item ablog__archive">
<h3>
  <a href="../blog/archive.html">Archives</a>
</h3>
<ul>
  
  
  <li>
    <a href="../blog/2025.html">2025 (4)</a>
  </li>
  
  
  
  <li>
    <a href="../blog/2024.html">2024 (2)</a>
  </li>
  
  
  
  <li>
    <a href="../blog/2023.html">2023 (8)</a>
  </li>
  
  
  
  <li>
    <a href="../blog/2022.html">2022 (7)</a>
  </li>
  
  
</ul>
</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/blackmagic-debug/black-magic-org/blob/main/usage/gdb-automation.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/blackmagic-debug/black-magic-org/edit/main/usage/gdb-automation.md" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          
          
          

          <section id="gdb-flash-automation">
<h1>GDB Flash Automation<a class="headerlink" href="#gdb-flash-automation" title="Link to this heading">¶</a></h1>
<p>In many cases it is useful to automatically flash and test the uploaded firmware. GDB has a built in scripting language as well as python bindings.</p>
<p>Here is a collection of a few ways to automate the flashing process.</p>
<p>There are many ways to accomplish this.</p>
<section id="commandline">
<h2>Commandline<a class="headerlink" href="#commandline" title="Link to this heading">¶</a></h2>
<p>For example with the following “one liner”:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>arm-none-eabi-gdb<span class="w"> </span>-nx<span class="w"> </span>--batch<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;target extended-remote /dev/ttyACM0&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;monitor swdp_scan&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;attach 1&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;load&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;compare-sections&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;kill&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>yourbinary.elf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember that <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code> is only valid on linux, you will need to use <code class="docutils literal notranslate"><span class="pre">COMx</span></code> for windows and <code class="docutils literal notranslate"><span class="pre">/dev/cu.usbmodemXXXXXXX1</span></code> for macOS.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As always you can use <code class="docutils literal notranslate"><span class="pre">monitor</span> <span class="pre">jtag_scan</span></code> instead of <code class="docutils literal notranslate"><span class="pre">monitor</span> <span class="pre">swdp_scan</span></code> to use JTAG protocol instead of SWD.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In cases when the target is not powered or you don’t have the VREF pin connected you will need to add <code class="docutils literal notranslate"><span class="pre">monitor</span> <span class="pre">tpwr</span> <span class="pre">enable</span></code> to enable power to the target side of the level translators. (especially important for BMP V2.0 and V2.1 probes)</p>
</div>
<p>The above invocation can be simplified if you put most of the <code class="docutils literal notranslate"><span class="pre">-ex</span></code> commands into a GDB script file. You can create a file named for example <code class="docutils literal notranslate"><span class="pre">black_magic_probe_flash.scr</span></code> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#monitor jtag_scan</span>
<span class="n">monitor</span> <span class="n">swdp_scan</span>
<span class="n">attach</span> <span class="mi">1</span>
<span class="n">load</span>
<span class="n">compare</span><span class="o">-</span><span class="n">sections</span>
<span class="n">kill</span>
</pre></div>
</div>
<p>Then the above invocation shrinks down to the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>arm-none-eabi-gdb<span class="w"> </span>-nx<span class="w"> </span>--batch<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s1">&#39;target extended-remote /dev/ttyACM0&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-x<span class="w"> </span>black_magic_probe_flash.scr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>yourbinary.elf
</pre></div>
</div>
</section>
<section id="makefile">
<h2>Makefile<a class="headerlink" href="#makefile" title="Link to this heading">¶</a></h2>
<p>If you are using GNU Makefiles for your project you can add a <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">flash</span></code> target. Reusing the script from the <a class="reference internal" href="#commandline">Commandline</a> section above the target like that can look something like this:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">flash</span><span class="o">:</span><span class="w"> </span><span class="n">yourbin</span>.<span class="n">flash</span>

<span class="nv">BMP_PORT</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span>/dev/ttyACM0

<span class="nf">%.flash</span><span class="o">:</span><span class="w"> </span>%.<span class="n">elf</span>
<span class="w">	</span>@printf<span class="w"> </span><span class="s2">&quot;  BMP </span><span class="k">$(</span>BMP_PORT<span class="k">)</span><span class="s2"> </span><span class="k">$(</span>*<span class="k">)</span><span class="s2">.elf (flash)\n&quot;</span>
<span class="w">	</span><span class="k">$(</span>Q<span class="k">)$(</span>GDB<span class="k">)</span><span class="w"> </span>-nx<span class="w"> </span>--batch<span class="w"> </span><span class="se">\</span>
<span class="w">	           </span>-ex<span class="w"> </span><span class="s1">&#39;target extended-remote $(BMP_PORT)&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">	           </span>-x<span class="w"> </span>black_magic_probe_flash.scr<span class="w"> </span><span class="se">\</span>
<span class="w">	           </span><span class="k">$(</span>*<span class="k">)</span>.elf
</pre></div>
</div>
<p>This is a very simple flash target. It assumes that your binary target ends with <code class="docutils literal notranslate"><span class="pre">.elf</span></code> suffix. You can call the target by running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">flash</span></code> and it will build the <code class="docutils literal notranslate"><span class="pre">yourbinary.elf</span></code>, flash it and test that the flash worked out.</p>
<p>You can also call the target providing a different Black Magic Probe GDB serial port by calling for example: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">flash</span> <span class="pre">BMP_PORT=/dev/cu.usbmodemXXXXXXX1</span></code> on Mac OS.</p>
<p>Following is a more complicated make setup that automatically detects Black Magic Probe GDB serial ports.</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">PREFIX</span><span class="w">		</span><span class="o">?=</span><span class="w"> </span>arm-none-eabi
<span class="nv">GDB</span><span class="w">		</span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>PREFIX<span class="k">)</span>-gdb
<span class="nv">SCRIPT_DIR</span><span class="w">	</span><span class="o">:=</span><span class="w"> </span>scripts

<span class="cp">ifeq ($(BMP_PORT),)</span>
<span class="nv">BMP_PORT_CANDIDATES</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span><span class="se">\</span>
/dev/serial/by-id/usb-Black_Sphere_Technologies_Black_Magic_Probe_*-if00<span class="w"> </span><span class="se">\</span>
<span class="err">/dev/cu.usbmodem*1)</span>
<span class="cp">ifeq ($(words $(BMP_PORT_CANDIDATES)),1)</span>
<span class="nv">BMP_PORT</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>BMP_PORT_CANDIDATES<span class="k">)</span>
<span class="cp">else</span>
<span class="nv">BMP_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>error<span class="w"> </span>Black<span class="w"> </span>Magic<span class="w"> </span>Probe<span class="w"> </span>gdb<span class="w"> </span>serial<span class="w"> </span>port<span class="w"> </span>not<span class="w"> </span>found,<span class="w"> </span>please<span class="w"> </span>provide<span class="w"> </span>the<span class="w"> </span>device<span class="w"> </span>name<span class="w"> </span>via<span class="w"> </span>the<span class="w"> </span>BMP_PORT<span class="w"> </span>variable<span class="w"> </span>parameter<span class="k">$(if</span><span class="w"> </span><span class="se">\</span>
<span class="k">$(</span><span class="nv">BMP_PORT_CANDIDATES</span><span class="k">)</span><span class="err">,</span><span class="w"> </span><span class="err">(found</span><span class="w"> </span><span class="k">$(</span><span class="nv">BMP_PORT_CANDIDATES</span><span class="k">)</span><span class="err">)))</span>
<span class="cp">endif</span>
<span class="cp">endif</span>
<span class="nf">%.flash</span><span class="o">:</span><span class="w"> </span>%.<span class="n">elf</span>
<span class="w">	</span>@printf<span class="w"> </span><span class="s2">&quot;  BMP </span><span class="k">$(</span>BMP_PORT<span class="k">)</span><span class="s2"> </span><span class="k">$(</span>*<span class="k">)</span><span class="s2">.elf (flash)\n&quot;</span>
<span class="w">	</span><span class="k">$(</span>Q<span class="k">)$(</span>GDB<span class="k">)</span><span class="w"> </span>-nx<span class="w"> </span>--batch<span class="w"> </span><span class="se">\</span>
<span class="w">	           </span>-ex<span class="w"> </span><span class="s1">&#39;target extended-remote $(BMP_PORT)&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">	           </span>-x<span class="w"> </span><span class="k">$(</span>SCRIPT_DIR<span class="k">)</span>/black_magic_probe_flash.scr<span class="w"> </span><span class="se">\</span>
<span class="w">	           </span><span class="k">$(</span>*<span class="k">)</span>.elf
</pre></div>
</div>
<p>For a full example using this kind of a makefile target you can look at the <a class="reference external" href="https://github.com/1Bitsy/1bitsy-locm3-template">1Bitsy template project</a>.</p>
</section>
<section id="windows-batch">
<h2>Windows Batch<a class="headerlink" href="#windows-batch" title="Link to this heading">¶</a></h2>
<p>You can use a similar technique on windows too. Here is a <code class="docutils literal notranslate"><span class="pre">.bat</span></code> that implements binary flashing:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="k">echo</span> off
<span class="c1">rem: Note %~dp0 get path of this batch file</span>
<span class="c1">rem: Need to change drive if My Documents is on a drive other than C:</span>
<span class="k">set</span> <span class="nv">driverLetter</span><span class="p">=</span><span class="nv">%~dp0</span>
<span class="k">set</span> <span class="nv">driverLetter</span><span class="p">=</span><span class="nv">%driverLetter:~0,2%</span>
<span class="nv">%driverLetter%</span>
<span class="k">cd</span> <span class="nv">%~dp0</span>
<span class="c1">rem: get all parameters that we will be using and make sure the slashes are all correct</span>
<span class="k">set</span> <span class="nv">working_directory</span><span class="p">=</span><span class="nv">%~p0</span>
<span class="k">set</span> <span class="nv">toolchain_path</span><span class="p">=</span><span class="nv">%~1</span>
<span class="k">set</span> <span class="nv">toolchain_path</span><span class="p">=</span><span class="nv">%toolchain_path:/=\%</span>
<span class="k">set</span> <span class="nv">bmp_gdb_port</span><span class="p">=</span><span class="nv">%2</span>
<span class="k">set</span> <span class="nv">bmp_gdb_port</span><span class="p">=</span><span class="nv">%bmp_gdb_port:/=\%</span>
<span class="k">set</span> <span class="nv">elf_file</span><span class="p">=</span><span class="nv">%3</span>
<span class="k">set</span> <span class="nv">elf_file</span><span class="p">=</span><span class="nv">%elf_file:/=\%</span>
<span class="nv">%toolchain_path%</span>\arm-none-eabi-gdb.exe --batch -nx <span class="se">^</span>
<span class="se">	</span>-ex <span class="s2">&quot;target extended-remote </span><span class="nv">%bmp_gdb_port%</span><span class="s2">&quot;</span> <span class="se">^</span>
<span class="se">	</span>-x <span class="nv">%working_directory%</span>..\shared\bmp_gdb_upload_swd.scr <span class="se">^</span>
<span class="se">	</span><span class="nv">%elf_file%</span>
</pre></div>
</div>
<p>This batch script takes three parameters: <code class="docutils literal notranslate"><span class="pre">toolchain</span> <span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">Black</span> <span class="pre">Magic</span> <span class="pre">Probe</span> <span class="pre">GDB</span> <span class="pre">Port</span> <span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">binary</span> <span class="pre">elf</span> <span class="pre">file</span></code>
You can call that batch script for example like this: <code class="docutils literal notranslate"><span class="pre">bmp_upload.bat</span> <span class="pre">C:\\gcc-arm-none-eabi\bin</span> <span class="pre">COM1</span> <span class="pre">yourbinary.elf</span></code></p>
</section>
<section id="in-production-batch-programming">
<h2>In Production Batch Programming<a class="headerlink" href="#in-production-batch-programming" title="Link to this heading">¶</a></h2>
<p>You can use the Black Magic Probe to bulk program large numbers of devices in production. The easiest way to accomplish that is to use one of the above techniques and run them in the loop. It is also useful to have audible response when the flash process has been successful. You can add an audio file playback at the end of the GDB script and it will only be played when the flash cycle has been successful.</p>
<p>Here is a onliner loop for your unix system of choice:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>sleep<span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>arm-none-eabi-gdb<span class="w"> </span>--batch<span class="w"> </span>-nx<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-ex<span class="w"> </span><span class="s2">&quot;target extended-remote /dev/ttyACM0&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-x<span class="w"> </span>gdb_upload.scr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>yourbinary.elf<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Note: It is useful to have a short period of sleep between the gdb invocations, otherwise it is difficult to break the loop with <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code> key combination. Most modern unix systems support also shorter periods than 1 as parameter to the sleep command. You can call it with 0.5 for half a second sleep period.</p>
<p>The newly added GDB flash script lines for audio response for Linux would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span> <span class="n">paplay</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">sounds</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">stereo</span><span class="o">/</span><span class="n">message</span><span class="o">.</span><span class="n">ogg</span>
<span class="n">shell</span> <span class="n">sleep</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Note: The additional 3 seconds of sleep after a successful firmware upload gives the operator time to disconnect the Black Magic Probe from the target without accidentally flashing the target multiple times. If you pull the cable in the middle of the flash process you can end up with a half programmed or reerased target…</p>
<p>And this is what those lines look like on macOS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span> <span class="n">afplay</span> <span class="o">/</span><span class="n">System</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">Sounds</span><span class="o">/</span><span class="n">Ping</span><span class="o">.</span><span class="n">aiff</span>
<span class="n">shell</span> <span class="n">sleep</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Note: The additional 3 seconds of sleep after a successful firmware upload gives the operator time to disconnect the Black Magic Probe from the target without accidentally flashing the target multiple times. If you pull the cable in the middle of the flash process you can end up with a half programmed or reerased target…</p>
<p>For convenience here is a full script that should work on an Ubuntu computer with a bunch of annotations as comments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print BMPM version</span>
<span class="n">monitor</span> <span class="n">version</span>
<span class="c1"># To make sure the target is not in a &quot;strange&quot; mode we tell BMPM to reset the</span>
<span class="c1"># target using the reset pin before connecting to it.</span>
<span class="n">monitor</span> <span class="n">connect_srst</span> <span class="n">enable</span>
<span class="c1"># Enable target power (aka. provide power to the target side of the level shifters)</span>
<span class="n">monitor</span> <span class="n">tpwr</span> <span class="n">enable</span>
<span class="c1"># Scan for devices using SWD interface</span>
<span class="n">monitor</span> <span class="n">swdp_scan</span>
<span class="c1"># Alternatively scan for devices using JTAG. (comment out the above line...)</span>
<span class="c1"># monitor jtag_scan</span>
<span class="c1"># Attach to the newly found target if available. (if it fails the script exits)</span>
<span class="n">attach</span> <span class="mi">1</span>
<span class="c1"># Success! Lets make some sound!</span>
<span class="n">shell</span> <span class="n">paplay</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">sounds</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">stereo</span><span class="o">/</span><span class="n">message</span><span class="o">.</span><span class="n">ogg</span>
<span class="c1"># Load aka. flash the binary</span>
<span class="n">load</span>
<span class="c1"># Check if the flash matches the binary</span>
<span class="n">compare</span><span class="o">-</span><span class="n">sections</span>
<span class="c1"># Reset the target and disconnect</span>
<span class="n">kill</span>
<span class="c1"># Write to the terminal that we succeeded</span>
<span class="n">echo</span> <span class="s2">&quot;Upload success!!!&quot;</span>
<span class="c1"># Finished flashing success! Lets make some more sound!</span>
<span class="n">shell</span> <span class="n">paplay</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">sounds</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">stereo</span><span class="o">/</span><span class="n">system</span><span class="o">-</span><span class="n">ready</span><span class="o">.</span><span class="n">ogg</span>
</pre></div>
</div>
</section>
<section id="auto-detecting-the-gdb-port-in-windows-powershell">
<h2>Auto-detecting the GDB port in Windows PowerShell<a class="headerlink" href="#auto-detecting-the-gdb-port-in-windows-powershell" title="Link to this heading">¶</a></h2>
<p>It is not ideal to have to manually determine the serial port name and type it into the script invocation each time. The following command in Windows PowerShell will detect the GDB port and set an environment variable, which can then be used to call GDB.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Get-CimInstance -ClassName Win32_SerialPort -Filter &quot;PNPDeviceID like &#39;USB\\VID_1D50&amp;PID_6018&amp;MI_00%&#39;&quot; | `
  Select -ExpandProperty DeviceID | Set-Variable -Name BMP_GDB_PORT

echo $BMP_GDB_PORT
</pre></div>
</div>
</section>
</section>

           
          <div class="section ablog__blog_comments">
            
            
          </div>
          
          
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="semihosting.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Semihosting</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="gdb-commands.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">GDB Commands</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, Piotr Esden-Tempski &lt;piotr@esden.net&gt;; 2022-2023, Rachel Mant &lt;git@dragonmux.network&gt;
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">GDB Flash Automation</a><ul>
<li><a class="reference internal" href="#commandline">Commandline</a></li>
<li><a class="reference internal" href="#makefile">Makefile</a></li>
<li><a class="reference internal" href="#windows-batch">Windows Batch</a></li>
<li><a class="reference internal" href="#in-production-batch-programming">In Production Batch Programming</a></li>
<li><a class="reference internal" href="#auto-detecting-the-gdb-port-in-windows-powershell">Auto-detecting the GDB port in Windows PowerShell</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/asciinema-player_3.12.1.js"></script>
    </body>
</html>