<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="../_static/favicon/icon.svg">
    <link rel="icon" sizes="16x16" type="image/png" href="../_static/favicon/favicon-16x16.png">
    <link rel="icon" sizes="32x32" type="image/png" href="../_static/favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="57x57" type="image/png" href="../_static/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" type="image/png" href="../_static/favicon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" type="image/png" href="../_static/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" type="image/png" href="../_static/favicon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="96x96" type="image/png" href="../_static/favicon/apple-touch-icon-96x96.png">
    <link rel="apple-touch-icon" sizes="114x114" type="image/png" href="../_static/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" type="image/png" href="../_static/favicon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" type="image/png" href="../_static/favicon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" type="image/png" href="../_static/favicon/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="../_static/favicon/apple-touch-icon-180x180.png">
    <link rel="android-icon" sizes="192x192" type="image/png" href="../_static/favicon/android-icon-192x192.png"><meta property="og:title" content="SWD - TRACESWO support" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://black-magic.org/usage/traceswo.html" />
<meta property="og:site_name" content="Black Magic Debug" />
<meta property="og:description" content="The Black Magic Probe when in Serial Wire Debug (rather than JTAG) mode can receive the TRACESWO diagnostic stream from targets which support it. ARM Cortex chips include a comprehensive tracing fr..." />
<meta property="og:image" content="https://black-magic.org/_static/blackmagic-logo.png" />
<meta property="og:image:alt" content="Black Magic Debug" />
<meta name="description" content="The Black Magic Probe when in Serial Wire Debug (rather than JTAG) mode can receive the TRACESWO diagnostic stream from targets which support it. ARM Cortex chips include a comprehensive tracing fr..." />

    <title>SWD - TRACESWO support &#8212; Black Magic Debug  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/asciinema-player_3.6.3.css" />
    <link rel="stylesheet" type="text/css" href="../_static/platformpicker.css" />
    <script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/platformpicker.js"></script>
    <link rel="canonical" href="https://black-magic.org/usage/traceswo.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Serial Wire Output" href="swo.html" />
    <link rel="prev" title="Semihosting" href="semihosting.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Blog"
/>



  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
<section id="swd-traceswo-support">
<h1>SWD - TRACESWO support<a class="headerlink" href="#swd-traceswo-support" title="Link to this heading">¶</a></h1>
<p>The Black Magic Probe when in Serial Wire Debug (rather than JTAG) mode can receive the TRACESWO diagnostic stream from targets which support it.</p>
<p>ARM Cortex chips include a comprehensive tracing framework, in brief there is an Embedded Trace Macrocell (ETM) which can generate trace output on various kinds of events such as data watchpoints, and there is an Instrumentation Trace Macrocell (ITM) which is similar but oriented towards software generated log messages. The instrumentation can be left enabled in your shipped product.</p>
<p>The ETM and ITM streams are combined in the TPIU which generates a series of frames in a specified format, this stream can be sent out on a 1-wire, 2-wire or 4-wire synchronous serial bus if enabled in your design, or it can be sent out the TRACESWO pin which is a 1-wire asynchronous serial stream. The TRACESWO output can be in UART (start, 8 data bits, stop) or Manchester encoded format.</p>
<p>The Black Magic Probe supports only the Manchester encoded format [at the time of writing – this may be out of date – see note at the end], which is a sensible choice because it allows automatic synchronization to the target’s baudrate (within some range of sensible speeds). Note that the Black Magic Probe uses essentially a bit-banged input-only UART for this task, implemented in software using a timer input capture pin, and does not support high baudrates.</p>
<p>Mostly the TRACESWO pin will be used as a convenient way to get printf() style output to the debugger host, without wasting an I/O pin by assigning a dedicated UART to this function. The ETM/ITM/TPIU scheme is over-designed for this task, so it makes sense to turn off formatting in the TPIU when doing this. This gives an output stream consisting of 16-bit words, each containing a stream ID and a character.</p>
<p>A simple Linux application is available to dump Black Magic Probe TRACESWO output to stdout. This will be fine for basic usage. See https://github.com/nickd4/bmp_traceswo, it also contains some sample code to insert in your STM32 application showing how to set up and use the ITM and TPIU for printf() style output. It would be good if this could be extended to give examples for other major families such as the NXP ARM chips, etc.</p>
<p>Note that the STM32 case is a bit peculiar (contains a so-called Pelican TPIU at a non-ARM-mandated address), so you will need this example to get started. The code in the example is derived from here:
https://mcuoneclipse.com/2016/10/17/tutorial-using-single-wire-output-swo-with-arm-cortex-m-and-eclipse
A better example is here, which is cleaner and also shows how to enable the TRACESWO pin, missing above:
http://forum.segger.com/index.php?page=Thread&amp;threadID=608</p>
<p>The major IDEs are also able to interpret TRACESWO packets, in particular the formatted style, which might be more appropriate for advanced usage, with separate windows for different streams, and search, filtering etc. It is uncertain whether these support the Black Magic Probe’s TRACESWO endpoint, if so please insert instructions.</p>
<p>See also https://github.com/tristanseifert/bmp_traceswo, the original version was taking one word at a time from the TRACESWO stream, ignoring the high byte and dumping the low byte, whereas this modification seems to be taking frames. I (nickd4) noticed the Black Magic TRACESWO firmware has changed and improved since my version was published, I will investigate it later. If you use Tristan’s fork, you should take the /etc/udev/rules.d/99-blackmagic.rules from https://github.com/nickd4/bmp_traceswo, since it has improved since the fork.</p>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/blackmagic-logo.svg" alt="Logo" />
    
  </a>
</p>



<p class="blurb">The Plug&Play MCU Debugger</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=blackmagic-debug&repo=blackmagic&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported-targets.html">Supported Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledgebase</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/pinouts.html">Pinout Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/compiling-windows.html">Compiling on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gdb-commands.html">GDB Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdb-automation.html">GDB Flash Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="semihosting.html">Semihosting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SWD - TRACESWO support</a></li>
<li class="toctree-l1"><a class="reference internal" href="swo.html">Serial Wire Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="rtt.html">Using RTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="platformio.html">PlatformIO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Target Specific Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/stm32.html">STM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/sam3x-4x-x7x.html">SAM3x-4x-x7x</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hacking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hacking/contrib.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/hacking.html">Firmware Hacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-drivers.html">Adding Target Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-cortex-m.html">Cortex-M Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-cortex-a.html">Cortex A Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-mm32.html">MindMotion MM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking/target-clock-generation.html">Target Clock Generation</a></li>
</ul>


<div class="ablog-sidebar-item ablog__recentposts">
<h3>
  <a href="../blog.html">Recent Posts</a>
</h3>
<ul>
  
  
  <li>
    <a href="../blog/2024-01-11-release-v1_9_3.html">
      11 January - Stable Release V1.9.3
    </a>
  </li>
  
  <li>
    <a href="../blog/2024-01-10-release-v1_10_2.html">
      10 January - Stable Release V1.10.2
    </a>
  </li>
  
  <li>
    <a href="../blog/2023-11-30-release-v1_10_1.html">
      30 November - Stable Release V1.10.1
    </a>
  </li>
  
  <li>
    <a href="../blog/2023-10-28-release-v1_10_0.html">
      28 October - Stable Release V1.10.0
    </a>
  </li>
  
  <li>
    <a href="../blog/2023-10-11-release-candidate-v1_10_0-rc1.html">
      11 October - Release Candidate V1.10.0-rc1
    </a>
  </li>
  
</ul>
</div>

<div class="ablog-sidebar-item ablog__archive">
<h3>
  <a href="../blog/archive.html">Archives</a>
</h3>
<ul>
  
  
  <li>
    <a href="../blog/2024.html">2024 (2)</a>
  </li>
  
  
  
  <li>
    <a href="../blog/2023.html">2023 (8)</a>
  </li>
  
  
  
  <li>
    <a href="../blog/2022.html">2022 (7)</a>
  </li>
  
  
</ul>
</div>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="semihosting.html" title="previous chapter">Semihosting</a></li>
      <li>Next: <a href="swo.html" title="next chapter">Serial Wire Output</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022-2023, Piotr Esden-Tempski <piotr@esden.net>; 2022-2023, Rachel Mant <git@dragonmux.network>.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>