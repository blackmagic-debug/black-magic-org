<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="../_static/favicon/icon.svg">
    <link rel="icon" sizes="16x16" type="image/png" href="../_static/favicon/favicon-16x16.png">
    <link rel="icon" sizes="32x32" type="image/png" href="../_static/favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="57x57" type="image/png" href="../_static/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" type="image/png" href="../_static/favicon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" type="image/png" href="../_static/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" type="image/png" href="../_static/favicon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="96x96" type="image/png" href="../_static/favicon/apple-touch-icon-96x96.png">
    <link rel="apple-touch-icon" sizes="114x114" type="image/png" href="../_static/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" type="image/png" href="../_static/favicon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" type="image/png" href="../_static/favicon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" type="image/png" href="../_static/favicon/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="../_static/favicon/apple-touch-icon-180x180.png">
    <link rel="android-icon" sizes="192x192" type="image/png" href="../_static/favicon/android-icon-192x192.png"><meta property="og:title" content="Firmware Hacking" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://black-magic.org/hacking/hacking.html" />
<meta property="og:site_name" content="Black Magic Debug" />
<meta property="og:description" content="The Black Magic Debug firmware is under the GPLv3 open-source license, all contributions to the project should be either GPLv3, BSD-3-Clause or MIT licenses. Any contributed hardware designs found ..." />
<meta property="og:image" content="https://black-magic.org/_static/blackmagic-logo.png" />
<meta property="og:image:alt" content="Black Magic Debug" />
<meta name="description" content="The Black Magic Debug firmware is under the GPLv3 open-source license, all contributions to the project should be either GPLv3, BSD-3-Clause or MIT licenses. Any contributed hardware designs found ..." />

    <title>Firmware Hacking &#8212; Black Magic Debug  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/asciinema-player_3.6.3.css" />
    <link rel="stylesheet" type="text/css" href="../_static/platformpicker.css" />
    <script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/asciinema-player_3.6.3.js"></script>
    <script src="../_static/platformpicker.js"></script>
    <link rel="canonical" href="https://black-magic.org/hacking/hacking.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding Target Drivers" href="target-drivers.html" />
    <link rel="prev" title="Contributing" href="contrib.html" /> 
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Blog"
/>
  
  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <section id="firmware-hacking">
<h1>Firmware Hacking<a class="headerlink" href="#firmware-hacking" title="Link to this heading">¶</a></h1>
<p>The Black Magic Debug firmware is under the GPLv3 open-source license, all contributions to the project
should be either GPLv3, BSD-3-Clause or MIT licenses.</p>
<p>Any contributed hardware designs found in the
<a class="reference external" href="https://github.com/blackmagic-debug/blackmagic-hardware/">hardware repository</a> is under the CC-BY-SA license.</p>
<p>Building the firmware requires an arm-none-eabi compiler of some sort. Recomended is the official
<a class="reference external" href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">ARM GNU Toolchain</a>.</p>
<section id="getting-the-project-source">
<h2>Getting the project source<a class="headerlink" href="#getting-the-project-source" title="Link to this heading">¶</a></h2>
<p>The project resides in a <a class="reference external" href="https://github.com/blackmagic-debug/blackmagic">GitHub git repository</a></p>
<p>Clone this repository (or fork and clone) using your desired method. Typically:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/blackmagic-debug/blackmagic
</pre></div>
</div>
</section>
<section id="compiling-for-the-native-hardware">
<h2>Compiling for the native hardware<a class="headerlink" href="#compiling-for-the-native-hardware" title="Link to this heading">¶</a></h2>
<p>For the native hardware, there are 5 pre-made configurations you can pick from, and the generic configuration
which can then be customised as you wish. The 5 configurations are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">native.ini</span></code> - Baseline configuration with support for ARM Cortex-M architecture parts. This includes the
target support for NXP LPC family parts, the nRF series’, NXP’s Kinetis and i.MXRT parts, RPi Foundation’s
MCUs (ARM parts only), Atmel’s ATSAM parts, ST’s parts and TI’s Stellaris/Tiva-C parts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">native-remote.ini</span></code> - A special configuration which only includes the remote protocol and acceleration
components with absolutely no target support enabled. This is designed for use with BMDA exclusively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">native-riscv.ini</span></code> - A special RISC-V configuration profile which contains only target and architecture
support for RISC-V devices.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">native-st-clones.ini</span></code> - A special configuration which supports only ST’s parts and their clones. This is
intended for users who are dealing only with ST’s parts or their clones. This includes support for parts
from Artery Tek, GigaDevice, WinChipHead, MindMotion, Puya and HDSC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">native-uncommon.ini</span></code> - A configuration of all the uncommon parts for all ARM Cortex architectures. This
includes support for Energy Micro’s parts, Renesas parts, Xilinx’s Zynq, and Ambiq’s Apollo3.</p></li>
</ul>
<p>We will use the native.ini configuration in the example build below. We recomend using version 12.2.Rel1 of the
<a class="reference external" href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">ARM GNU Toolchain</a> to build the firmware.
To start, we need to create a build directory from a configuration with Meson and then ask Meson to run the build:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>meson<span class="w"> </span>setup<span class="w"> </span>build<span class="w"> </span>--cross-file<span class="o">=</span>cross-file/native.ini
meson<span class="w"> </span>compile<span class="w"> </span>-C<span class="w"> </span>build
</pre></div>
</div>
<p>This will result in the following binary files in the build directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">blackmagic_native_firmware.elf</span></code> - ELF binary of the Black Magic debug probe.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackmagic_native_firmware.bin</span></code> - Flat binary of the Black Magic debug probe, load at <code class="docutils literal notranslate"><span class="pre">0x8002000</span></code>.</p></li>
</ul>
<p>If you need the bootloader as well, then <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">build</span></code> and run <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">boot-bin</span></code> which will compile the
bootloader and generate a .bin file for it for use with provisioning tools. This results in two files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">blackmagic_native_bootloader.elf</span></code> - ELF binary of the Black Magic DFU bootloader.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackmagic_native_bootloader.bin</span></code> - Flat binary of the DFU bootloader, load at <code class="docutils literal notranslate"><span class="pre">0x8000000</span></code>.</p></li>
</ul>
</section>
<section id="alternative-hardware">
<h2>Alternative Hardware<a class="headerlink" href="#alternative-hardware" title="Link to this heading">¶</a></h2>
<p>There are a number of platforms that have been contributed by the community to the main repository. You can
make use of them by subsituting out <code class="docutils literal notranslate"><span class="pre">native.ini</span></code> in the instructions for native with one of the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">96b_carbon.ini</span></code> - Configuration for <a class="reference external" href="https://www.96boards.org/product/carbon/">96Boards’ Carbon</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackpill-f401cc.ini</span></code> - Configuration for the WeAct Studio
<a class="reference external" href="https://github.com/WeActStudio/WeActStudio.MiniSTM32F4x1">Black Pill F401CC</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackpill-f401ce.ini</span></code> - Configuration for the WeAct Studio
<a class="reference external" href="https://github.com/WeActStudio/WeActStudio.MiniSTM32F4x1">Black Pill F401CE</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blackpill-f411ce.ini</span></code> - Configuration for the WeAct Studio
<a class="reference external" href="https://github.com/WeActStudio/WeActStudio.MiniSTM32F4x1">Black Pill F411CE</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bluepill.ini</span></code> - Configuration for the WeAct Studio Blue Pill</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctxlink.ini</span></code> - Configuration for <a class="reference external" href="https://www.crowdsupply.com/sid-price/ctxlink">Sid Price’s ctxLink</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f072.ini</span></code> - Configuration for STM32F072’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f3.ini</span></code> - Configuration for STM32F3’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f4discovery.ini</span></code> - Configuration for ST’s
<a class="reference external" href="https://www.st.com/en/evaluation-tools/stm32f4discovery.html">STM32F4 Discovery</a> board</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hydrabus.ini</span></code> - Configuration for <a class="reference external" href="https://hydrabus.com/">HydraBus</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">launchpad-icdi.ini</span></code> - Configuration for the ICDI on TI’s Launchpad boards</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stlink.ini</span></code> - Configuration for ST-Link v2, and ST-Link v2.1 adaptors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stlinkv3.ini</span></code> - Configuration for ST-Link v3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">swlink.ini</span></code> - Configuration for ST-Link and Blue Pill (read the README.md before using this)</p></li>
</ul>
<p>For the ST-Link platform, the default is for the project bootloader to be disabled so it can be used with
ST’s own and <code class="docutils literal notranslate"><span class="pre">stlink-tool</span></code>. If you wish to use the project’s bootloader and replace ST’s, then pass
<code class="docutils literal notranslate"><span class="pre">-Dbmd_bootloader=true</span></code> on the end of the <code class="docutils literal notranslate"><span class="pre">meson</span> <span class="pre">setup</span></code> line and follow the bootloader build instructions
as well to generate the files to use to start over on the ST-Link probe.</p>
</section>
<section id="building-on-windows">
<h2>Building on Windows<a class="headerlink" href="#building-on-windows" title="Link to this heading">¶</a></h2>
<p>For windows-specific instructions, please use the <a class="reference internal" href="../knowledge/compiling-windows.html"><span class="std std-doc">Compiling on Windows</span></a> guide.</p>
<section id="compiling-as-a-host-computer-program">
<h3>Compiling as a host computer program<a class="headerlink" href="#compiling-as-a-host-computer-program" title="Link to this heading">¶</a></h3>
<p>Black Magic Debug App (BMDA) is compiled by default when building the firwmare if the dependencies for it
can be resolved. If you wish to build just BMDA on its own however, you can run the following two Meson
commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>meson<span class="w"> </span>setup<span class="w"> </span>build
meson<span class="w"> </span>compile<span class="w"> </span>-C<span class="w"> </span>build
</pre></div>
</div>
<p>This will generate one file in the build directory - <code class="docutils literal notranslate"><span class="pre">blackmagic</span></code>. This is the BMDA executable.</p>
</section>
</section>
<section id="enabling-debug-messages">
<h2>Enabling debug messages<a class="headerlink" href="#enabling-debug-messages" title="Link to this heading">¶</a></h2>
<p>All debug messages are compiled into BMDA, always. To enable more of the diagnostic output, use the <code class="docutils literal notranslate"><span class="pre">-v</span></code> flag.
This flag is a bitmask with a maximum value of 63. There are 6 sets of diagnostics that can be enabled:</p>
<ul class="simple">
<li><p>1  - INFO: General informational diagnostics</p></li>
<li><p>2  - GDB: GDB remote protocol diagnostics</p></li>
<li><p>4  - TARGET: Target-specific diagnostics</p></li>
<li><p>8  - PROTO: Target debug protocol diagnostics</p></li>
<li><p>16 - PROBE: Probe protocol diagnostics</p></li>
<li><p>32 - WIRE: USB communication with probe (“wire-level”) diagnostics</p></li>
</ul>
<p>There are two additional always-enabled levels for BMDA - <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> and <code class="docutils literal notranslate"><span class="pre">WARN</span></code>.</p>
<p>For the firmware, pass <code class="docutils literal notranslate"><span class="pre">-Ddebug_output=true</span></code> to the end of the <code class="docutils literal notranslate"><span class="pre">meson</span> <span class="pre">setup</span></code> line and build. This will include
some of the levels into the firmware such as ERROR, WARN, and INFO. You can then enable the messages at runtime
with the <code class="docutils literal notranslate"><span class="pre">monitor</span></code> command this adds:</p>
<div class="highlight-gdb notranslate"><div class="highlight"><pre><span></span>monitor debug_bmp enable
</pre></div>
</div>
<p>The debug messages appear on the target debug UART. An example of its usage follows below:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>minicom<span class="w"> </span>-D<span class="w"> </span>/dev/ttyBmpTarg<span class="w"> </span>-8
</pre></div>
</div>
<p>To exit <code class="docutils literal notranslate"><span class="pre">minicom</span></code>, type Ctrl + A then Q and answer “Yes” to the question about leaving without reset by typing
Enter. This will return you to the original console.</p>
</section>
<section id="updating-firmware">
<h2>Updating firmware<a class="headerlink" href="#updating-firmware" title="Link to this heading">¶</a></h2>
<p>Follow instructions in <a class="reference internal" href="../upgrade.html"><span class="std std-doc">Firmware Upgrade Section</span></a>.</p>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/blackmagic-logo.svg" alt="Logo" />
    
  </a>
</p>



<p class="blurb">The Plug&Play MCU Debugger</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=blackmagic-debug&repo=blackmagic&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Firmware Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported-targets.html">Supported Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Knowledgebase</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/pinouts.html">Pinout Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/compiling-windows.html">Compiling on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge/links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/gdb-commands.html">GDB Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/gdb-automation.html">GDB Flash Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/semihosting.html">Semihosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/swo.html">Serial Wire Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/rtt.html">Using RTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/platformio.html">PlatformIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Target Specific Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/stm32.html">STM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target-usage/sam3x-4x-x7x.html">SAM3x-4x-x7x</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hacking</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Firmware Hacking</a></li>
<li class="toctree-l1"><a class="reference internal" href="target-drivers.html">Adding Target Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="target-cortex-m.html">Cortex-M Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="target-cortex-a.html">Cortex A Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="target-mm32.html">MindMotion MM32 Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="target-clock-generation.html">Target Clock Generation</a></li>
</ul>

<h3>Versions</h3>
<ul>
	<li><a href="/">BMD 2.0 (in development)</a></li>
	<li><a href="/v1.x">BMD 1.10.2 (stable)</a></li>
</ul>
<div class="ablog-sidebar-item ablog__recentposts">
  <h3>
    <a href="../blog.html">Recent Posts</a>
  </h3>
  <ul>
     
    <li>
      <a href="../blog/2024-01-11-release-v1_9_3.html">
        11 January - Stable Release V1.9.3
      </a>
    </li>
    
    <li>
      <a href="../blog/2024-01-10-release-v1_10_2.html">
        10 January - Stable Release V1.10.2
      </a>
    </li>
    
    <li>
      <a href="../blog/2023-11-30-release-v1_10_1.html">
        30 November - Stable Release V1.10.1
      </a>
    </li>
    
    <li>
      <a href="../blog/2023-10-28-release-v1_10_0.html">
        28 October - Stable Release V1.10.0
      </a>
    </li>
    
    <li>
      <a href="../blog/2023-10-11-release-candidate-v1_10_0-rc1.html">
        11 October - Release Candidate V1.10.0-rc1
      </a>
    </li>
    
  </ul>
</div>

<div class="ablog-sidebar-item ablog__archives">
  <h3>
    <a href="../blog/archive.html">Archives</a>
  </h3>
  <ul>
     
    <li>
      <a href="../blog/2024.html">2024 (2)</a>
    </li>
      
    <li>
      <a href="../blog/2023.html">2023 (8)</a>
    </li>
      
    <li>
      <a href="../blog/2022.html">2022 (7)</a>
    </li>
     
  </ul>
</div>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="contrib.html" title="previous chapter">Contributing</a></li>
      <li>Next: <a href="target-drivers.html" title="next chapter">Adding Target Drivers</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022-2023, Piotr Esden-Tempski <piotr@esden.net>; 2022-2023, Rachel Mant <git@dragonmux.network>.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>